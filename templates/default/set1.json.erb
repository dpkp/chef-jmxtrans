
{
 "servers": [
<% more = false -%>
<% @servers.each do |hostname, server| -%>
  <% if more -%>
  ,
  <% end -%>
  {
    <% if server.has_key?('numQueryThreads') -%>
      <% log "server has numQueryThreads!" -%>
   "numQueryThreads": <%= server['numQueryThreads'] %>,
    <% end -%>
   "host": "<%= server[:host] %>",
    <% if server.has_key?(:username) -%>
   "username": "<%= server[:username] %>",
   "password": "<%= server[:password] %>",
    <% end -%>
   "port": <%= server[:port] %>,
   "alias": "<%= hostname %>",
   "queries": [
  <% server['queries'].each_with_index do |query,index| -%>
    <% unless index == 0 -%>
    ,
    <% end -%>
    {
     "outputWriters": [
      {
       "@class": "com.googlecode.jmxtrans.model.output.GraphiteWriter",
       "settings": {
        "typeNames": [ "name" ],
        "host": "<%= @graphite_host %>",
        "port": <%= @graphite_port %>,
        "rootPrefix": "<%= @root_prefix %>"
       }
      }
     ],
     "resultAlias": "<%= query['result_alias'] %>",
     "obj": "<%= query['obj'] %>",
     "attr": [<%= query['attr'].map {|t| "\""+t.to_s+"\""}.join(', ') %>]
    }
  <% end -%>
    ]
 }
  <% more = true -%>
<% end -%>
] 
}
