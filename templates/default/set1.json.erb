
{
 "servers": [
<% more = false -%>
<% @servers.each do |server| -%>
  <% if more -%>
  ,
  <% end -%>
  {
    <% if server.has_key?(:numQueryThreads) -%>
   "numQueryThreads": <%= server[:numQueryThreads] %>,
    <% end -%>
   "host": "<%= server[:host] %>",
    <% if server.has_key?(:username) -%>
   "username": "<%= server[:username] %>",
   "password": "<%= server[:password] %>",
    <% end -%>
   "port": <%= server[:port] %>,
    <% if server.has_key?(:alias) -%>
   "alias": "<%= server[:alias] %>",
    <% end -%>
   "queries": [
  <% server[:queries].each_with_index do |query,index| -%>
    <% unless index == 0 -%>
    ,
    <% end -%>
    {
     "outputWriters": [
     <% case @output_type -%>
     <% when 'graphite' -%>
      {
       "@class": "com.googlecode.jmxtrans.model.output.GraphiteWriter",
       "settings": {
        "typeNames": [ "name" ],
        "host": "<%= @output_host %>",
        "port": <%= @output_port %>,
        "rootPrefix": "<%= @root_prefix %>"
       }
      }
     <% when 'statsd' -%>
      {
       "@class": "com.googlecode.jmxtrans.model.output.StatsDWriter",
       "settings": {
        "typeNames": [ "name" ],
        "host": "<%= @output_host %>",
        "port": <%= @output_port %>,
	"rootPrefix": "<%= @root_prefix %>",
        "bucketType": "g"
       }
      }
     <% end -%>
     ],
     "resultAlias": "<%= query['result_alias'] %>",
     "obj": "<%= query['obj'] %>",
     "attr": [<%= query['attr'].map {|t| "\""+t.to_s+"\""}.join(', ') %>]
    }
  <% end -%>
    ]
 }
  <% more = true -%>
<% end -%>
] 
}
